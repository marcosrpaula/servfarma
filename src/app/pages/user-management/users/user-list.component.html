<app-breadcrumbs title="Usuarios" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>

<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div>
          <h5 class="card-title mb-1">Usuarios</h5>
          <p class="text-muted mb-0">Gerencie o acesso dos usuarios e seus perfis.</p>
        </div>
        <button
          type="button"
          class="btn btn-primary"
          (click)="createUser()"
          *appHasPermission="'user:write'"
        >
          <i class="ri-user-add-line align-middle me-1"></i>
          Novo usuario
        </button>
      </div>
      <div class="card-body p-0">
        @if (loading) {
        <div class="p-5 text-center text-muted">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
          <p class="mt-3 mb-0">Carregando usuarios...</p>
        </div>
        } @else if (error) {
        <div class="p-4">
          <div class="alert alert-danger mb-0" role="alert">
            {{ error }}
          </div>
        </div>
        } @else if (!users.length) {
        <div class="p-5 text-center text-muted">
          <i class="ri-user-line display-6 mb-3 d-block"></i>
          <p class="fs-6 mb-1">Nenhum usuario encontrado.</p>
          <p class="mb-0">Utilize o botao acima para cadastrar o primeiro usuario.</p>
        </div>
        } @else {
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Nome</th>
                <th>E-mail</th>
                <th class="text-center">Status</th>
                <th>Perfis</th>
                <th class="text-end">Acoes</th>
              </tr>
            </thead>
            <tbody>
              @for (user of users; track trackByUserId($index, user)) {
              <tr>
                <td>
                  <div class="fw-semibold">{{ user.name || 'Sem nome' }}</div>
                  <div class="text-muted small">ID: {{ user.id }}</div>
                </td>
                <td>{{ user.email }}</td>
                <td class="text-center">
                  <span class="badge" [ngClass]="user.active ? 'badge-soft-success' : 'badge-soft-secondary'">
                    {{ user.active ? 'Ativo' : 'Inativo' }}
                  </span>
                </td>
                <td>
                  @if (user.permissions.length) {
                  {{ getRoleNames(user) }}
                  } @else {
                  <span class="text-muted">Sem perfis associados</span>
                  }
                </td>
                <td class="text-end">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-primary"
                    (click)="editUser(user)"
                    *appHasPermission="'user:write'"
                  >
                    <i class="ri-edit-line align-middle"></i>
                    <span class="ms-1">Editar</span>
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        }
      </div>
    </div>
  </div>
</div>
